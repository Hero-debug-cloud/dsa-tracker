<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>DSA Tracker</title>
  <style>
    :root {
      --bg: #fafafa;
      --card: #ffffff;
      --fg: #09090b;
      --muted: #71717a;
      --border: #e4e4e7;
      --success-bg: #dcfce7;
      --success-fg: #166534;
      --warning-bg: #fef9c3;
      --warning-fg: #854d0e;
      --danger-bg: #fee2e2;
      --danger-fg: #991b1b;
      --accent-bg: #f0f9ff;
      --accent-fg: #0369a1;
      --radius: 12px;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 32px 16px;
      background: linear-gradient(var(--bg), #f4f4f5);
      font-family:
        -apple-system,
        BlinkMacSystemFont,
        "Inter",
        "Segoe UI",
        Roboto,
        Helvetica,
        Arial,
        sans-serif;
      color: var(--fg);
      font-size: 13px;
      line-height: 1.55;
    }

    .card {
      max-width: 820px;
      margin: 0 auto;
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 28px;
      box-shadow:
        0 1px 2px rgba(0, 0, 0, .04),
        0 8px 24px rgba(0, 0, 0, .05);
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 16px;
      margin-bottom: 24px;
    }

    .header h1 {
      font-size: 20px;
      font-weight: 600;
      margin: 0 0 6px;
      color: var(--fg);
    }

    .header-meta {
      color: var(--muted);
      font-size: 12px;
    }

    nav {
      display: flex;
      border-radius: 8px;
      background: #f8fafc;
      border: 1px solid var(--border);
      padding: 4px;
      gap: 4px;
      margin-bottom: 24px;
    }

    nav button {
      flex: 1;
      padding: 8px 16px;
      border-radius: 6px;
      border: none;
      cursor: pointer;
      font-weight: 500;
      font-size: 13px;
      color: var(--muted);
      background: transparent;
      transition: all 150ms ease;
    }

    nav button:hover {
      color: var(--fg);
      background: #f1f5f9;
    }

    nav button.active {
      color: var(--fg);
      background: var(--card);
      box-shadow: 0 1px 2px rgba(0, 0, 0, .1);
    }

    .section {
      margin-top: 26px;
    }

    .section-title {
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 10px;
      color: var(--fg);
    }

    .section-box {
      border: 1px solid var(--border);
      border-radius: var(--radius);
      overflow: hidden;
      background: var(--card);
    }

    section {
      display: none;
    }

    section.active {
      display: block;
    }

    h2 {
      margin: 0 0 16px;
      font-size: 16px;
      font-weight: 600;
      color: var(--fg);
    }

    label {
      font-size: 12px;
      font-weight: 500;
      color: var(--fg);
      display: block;
      margin-bottom: 4px;
    }

    input,
    select,
    textarea,
    button {
      font: inherit;
    }

    input,
    select,
    textarea {
      width: 100%;
      padding: 8px 12px;
      margin: 4px 0;
      border-radius: 6px;
      border: 1px solid var(--border);
      background: var(--card);
      color: var(--fg);
      outline: none;
      transition: border-color 150ms ease;
    }

    input::placeholder,
    textarea::placeholder {
      color: var(--muted);
    }

    input:focus,
    select:focus,
    textarea:focus {
      border-color: #3b82f6;
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }

    textarea {
      min-height: 80px;
      resize: vertical;
    }

    .actions-row {
      display: flex;
      justify-content: flex-end;
      gap: 8px;
      margin-top: 16px;
    }

    button {
      border-radius: 6px;
      border: 1px solid var(--border);
      padding: 8px 16px;
      background: var(--fg);
      color: var(--card);
      cursor: pointer;
      font-weight: 500;
      font-size: 13px;
      transition: all 150ms ease;
    }

    button:hover {
      background: #374151;
    }

    button.secondary {
      background: var(--card);
      color: var(--fg);
      border-color: var(--border);
    }

    button.secondary:hover {
      background: #f8fafc;
    }

    button.small {
      padding: 4px 8px;
      font-size: 11px;
      font-weight: 500;
      margin-right: 4px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 16px;
    }

    th,
    td {
      padding: 12px 14px;
      font-size: 12px;
      text-align: left;
      vertical-align: top;
    }

    th {
      background: #f4f4f5;
      color: #18181b;
      font-weight: 500;
      border-bottom: 1px solid var(--border);
    }

    tr:not(:last-child) td {
      border-bottom: 1px solid var(--border);
    }

    tbody tr:nth-child(even) {
      background: #fafafa;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      padding: 3px 10px;
      font-size: 11px;
      font-weight: 500;
      border-radius: 999px;
      white-space: nowrap;
    }

    .pill {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 11px;
      font-weight: 500;
      white-space: nowrap;
    }

    .pill-easy {
      background: var(--success-bg);
      color: var(--success-fg);
    }

    .pill-medium {
      background: var(--warning-bg);
      color: var(--warning-fg);
    }

    .pill-hard {
      background: var(--danger-bg);
      color: var(--danger-fg);
    }

    .pill-status-solved {
      background: var(--success-bg);
      color: var(--success-fg);
    }

    .pill-status-revisit {
      background: var(--warning-bg);
      color: var(--warning-fg);
    }

    .pill-status-unsolved {
      background: var(--danger-bg);
      color: var(--danger-fg);
    }

    .flex {
      display: flex;
      gap: 12px;
      margin: 8px 0;
    }

    .flex>* {
      flex: 1;
    }

    .stats-grid {
      margin-top: 16px;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
    }

    .stat-card {
      padding: 16px;
      border-radius: var(--radius);
      background: var(--card);
      border: 1px solid var(--border);
    }

    .stat-label {
      font-size: 12px;
      font-weight: 500;
      color: var(--muted);
      margin-bottom: 4px;
    }

    .stat-main {
      font-size: 20px;
      font-weight: 600;
      color: var(--fg);
      margin-bottom: 2px;
    }

    .stat-sub {
      font-size: 12px;
      color: var(--muted);
    }

    .stat-tag-row {
      margin-top: 8px;
      font-size: 11px;
      color: var(--muted);
    }

    @media (max-width: 768px) {
      .card {
        margin: 16px;
        padding: 20px;
      }

      .flex {
        flex-direction: column;
      }

      table {
        font-size: 11px;
      }

      th,
      td {
        padding: 8px 10px;
      }
    }

    /* Modal Styles */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transition: all 200ms ease;
    }

    .modal-overlay.active {
      opacity: 1;
      visibility: visible;
    }

    .modal {
      background: var(--card);
      border-radius: var(--radius);
      padding: 24px;
      width: 90%;
      max-width: 500px;
      border: 1px solid var(--border);
      box-shadow: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 10px 10px -5px rgb(0 0 0 / 0.04);
      transform: scale(0.95);
      transition: transform 200ms ease;
    }

    .modal-overlay.active .modal {
      transform: scale(1);
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 16px;
      border-bottom: 1px solid var(--border);
    }

    .modal-title {
      font-size: 18px;
      font-weight: 600;
      color: var(--fg);
      margin: 0;
    }

    .modal-close {
      background: none;
      border: none;
      font-size: 20px;
      color: var(--muted);
      cursor: pointer;
      padding: 4px;
      border-radius: 4px;
      transition: all 150ms ease;
    }

    .modal-close:hover {
      background: #f1f5f9;
      color: var(--fg);
    }

    .add-problem-btn {
      background: #3b82f6;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: all 150ms ease;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .add-problem-btn:hover {
      background: #2563eb;
      transform: translateY(-1px);
    }

    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }
  </style>
</head>

<body>
  <div class="card">
    <div class="header">
      <div>
        <h1>DSA Tracker</h1>
        <div class="header-meta">
          <strong>Data Structures & Algorithms</strong> Â· Progress Tracker
        </div>
      </div>
    </div>

    <nav>
      <button class="tab-btn active" data-tab="problems-tab">Problems</button>
      <button class="tab-btn" data-tab="attempts-tab">Attempts</button>
      <button class="tab-btn" data-tab="stats-tab">Stats</button>
      <button class="tab-btn" data-tab="leaderboard-tab">Leaderboard</button>
    </nav>

    <!-- Problems Tab -->
    <section id="problems-tab" class="active">
      <div class="section">
        <div class="section-header">
          <div class="section-title">Problems</div>
          <button class="add-problem-btn" onclick="openAddProblemModal()">
            <span>+</span> Add Problem
          </button>
        </div>
        <div class="section-box">
          <div style="padding: 16px 16px 0;">
            <div class="flex">
              <select id="list-user" onchange="loadProblems()">
                <option value="">All Problems</option>
                <option value="Akshaya">Akshaya</option>
                <option value="Arpan">Arpan</option>
                <option value="Vinay">Vinay</option>
                <option value="Pradyum">Pradyum</option>
                <option value="Lavanya">Lavanya</option>
              </select>
            </div>
          </div>
          <table id="problems-table">
            <thead>
              <tr>
                <th>ID</th>
                <th>Platform</th>
                <th>Name</th>
                <th>Topic</th>
                <th>Difficulty</th>
                <th>Status</th>
                <th>Solved By</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- Add Problem Modal -->
    <div id="add-problem-modal" class="modal-overlay">
      <div class="modal">
        <div class="modal-header">
          <h3 class="modal-title">Add New Problem</h3>
          <button class="modal-close" onclick="closeAddProblemModal()">&times;</button>
        </div>
        <div class="flex">
          <input placeholder="Platform" id="platform" />
          <input placeholder="Name" id="name" />
        </div>
        <div class="flex">
          <input placeholder="Link" id="link" />
          <input placeholder="Topic" id="topic" />
          <select id="difficulty">
            <option>Easy</option>
            <option>Medium</option>
            <option>Hard</option>
          </select>
        </div>
        <div class="actions-row">
          <button class="secondary" onclick="closeAddProblemModal()">Cancel</button>
          <button onclick="addProblem()">Add Problem</button>
        </div>
      </div>
    </div>

    <!-- Attempts Tab -->
    <section id="attempts-tab">
      <div class="section">
        <div class="section-title">Add Attempt</div>
        <div class="section-box">
          <div style="padding: 16px;">
            <div class="flex">
              <select id="attempt-user">
                <option value="">Select user</option>
                <option value="Akshaya">Akshaya</option>
                <option value="Arpan">Arpan</option>
              </select>
              <input placeholder="Problem ID" type="number" id="problem-id" />
              <input placeholder="Date (YYYY-MM-DD)" id="attempt-date" />
            </div>
            <div class="flex">
              <select id="status">
                <option>Solved</option>
                <option>Revisit</option>
                <option>Unsolved</option>
              </select>
              <input placeholder="Time taken (min)" type="number" id="time-taken" />
              <select id="first-try">
                <option value="1">First Try</option>
                <option value="0">Not First Try</option>
              </select>
            </div>
            <textarea placeholder="Notes" id="notes"></textarea>
            <div class="actions-row">
              <button onclick="addAttempt()">Add Attempt</button>
            </div>
          </div>
        </div>
      </div>

      <div class="section">
        <div class="section-title">Attempt History</div>
        <div class="section-box">
          <div style="padding: 16px 16px 0;">
            <div class="flex">
              <select id="attempt-list-user">
                <option value="">All Users</option>
                <option value="Akshaya">Akshaya</option>
                <option value="Arpan">Arpan</option>
                <option value="Vinay">Vinay</option>
                <option value="Pradyum">Pradyum</option>
                <option value="Lavanya">Lavanya</option>
              </select>
              <button class="secondary" onclick="loadAttempts()">Load Attempts</button>
            </div>
          </div>
          <table id="attempts-table">
            <thead>
              <tr>
                <th>ID</th>
                <th>Problem</th>
                <th>Date</th>
                <th>Status</th>
                <th>Time (min)</th>
                <th>First Try</th>
                <th>Notes</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- Stats Tab -->
    <section id="stats-tab">
      <div class="section">
        <div class="section-title">Statistics</div>
        <div class="section-box">
          <div style="padding: 16px 16px 0;">
            <div class="flex">
              <select id="stats-user">
                <option value="">All Users</option>
                <option value="Akshaya">Akshaya</option>
                <option value="Arpan">Arpan</option>
                <option value="Vinay">Vinay</option>
                <option value="Pradyum">Pradyum</option>
                <option value="Lavanya">Lavanya</option>
              </select>
              <button class="secondary" onclick="loadStats()">Load Stats</button>
            </div>
          </div>
          <div id="stats-output" class="stats-grid" style="padding: 0 16px 16px;"></div>
        </div>
      </div>
    </section>

    <!-- Leaderboard Tab -->
    <section id="leaderboard-tab">
      <div class="section">
        <div class="section-title">Leaderboard</div>
        <div class="section-box">
          <div style="padding: 16px 16px 0;">
            <div class="flex">
              <select id="leaderboard-user">
                <option value="">All Users</option>
                <option value="Akshaya">Akshaya</option>
                <option value="Arpan">Arpan</option>
                <option value="Vinay">Vinay</option>
                <option value="Pradyum">Pradyum</option>
                <option value="Lavanya">Lavanya</option>
              </select>
              <button class="secondary" onclick="loadLeaderboard()">Load Leaderboard</button>
            </div>
          </div>
          <table id="leaderboard-table">
            <thead>
              <tr>
                <th>Rank</th>
                <th>User</th>
                <th>Medium/Hard Solved</th>
                <th>Total Solved</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </section>
  </div>

  <script type="text/babel">
    // --------- Tab switching logic ---------
    document.querySelectorAll(".tab-btn").forEach(btn => {
      btn.addEventListener("click", () => {
        document.querySelectorAll(".tab-btn").forEach(b => b.classList.remove("active"));
        btn.classList.add("active");
        const tab = btn.dataset.tab;
        document.querySelectorAll("section").forEach(s => s.classList.remove("active"));
        document.getElementById(tab).classList.add("active");
      });
    });

    // --------- Modal functions ---------
    function openAddProblemModal() {
      document.getElementById('add-problem-modal').classList.add('active');
      // Clear form
      document.getElementById('platform').value = '';
      document.getElementById('name').value = '';
      document.getElementById('link').value = '';
      document.getElementById('topic').value = '';
      document.getElementById('difficulty').value = 'Easy';
    }

    function closeAddProblemModal() {
      document.getElementById('add-problem-modal').classList.remove('active');
    }

    // Close modal when clicking outside
    document.getElementById('add-problem-modal').addEventListener('click', function (e) {
      if (e.target === this) {
        closeAddProblemModal();
      }
    });

    // Close modal with Escape key
    document.addEventListener('keydown', function (e) {
      if (e.key === 'Escape') {
        closeAddProblemModal();
      }
    });

    // --------- API calls ---------
    async function addProblem() {
      const platform = document.getElementById("platform").value;
      const name = document.getElementById("name").value;
      const link = document.getElementById("link").value;
      const topic = document.getElementById("topic").value;
      const difficulty = document.getElementById("difficulty").value;

      if (!platform || !name || !topic) {
        alert("Please fill in all required fields (Platform, Name, Topic)");
        return;
      }

      try {
        await fetch("/problems", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ platform, name, link, topic, difficulty })
        });
        alert("Problem added successfully!");
        closeAddProblemModal();
        loadProblems();
      } catch (error) {
        alert("Error adding problem: " + error.message);
      }
    }

    async function addAttempt() {
      const user = document.getElementById("attempt-user").value;
      const problem_id = parseInt(document.getElementById("problem-id").value);
      const date = document.getElementById("attempt-date").value;
      const status = document.getElementById("status").value;
      const time_taken = parseInt(document.getElementById("time-taken").value);
      const first_try = parseInt(document.getElementById("first-try").value);
      const notes = document.getElementById("notes").value;

      if (!user || !problem_id || !date) {
        alert("Please fill in all required fields (User, Problem ID, Date)");
        return;
      }

      try {
        const response = await fetch("/attempts", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ user, problem_id, date, status, time_taken, first_try, notes })
        });

        if (!response.ok) {
          const errorData = await response.json();
          throw new Error(errorData.error || 'Failed to add attempt');
        }

        alert("Attempt added successfully!");
        // Clear form
        document.getElementById("attempt-user").value = "";
        document.getElementById("problem-id").value = "";
        document.getElementById("attempt-date").value = "";
        document.getElementById("status").value = "Solved";
        document.getElementById("time-taken").value = "";
        document.getElementById("first-try").value = "1";
        document.getElementById("notes").value = "";
      } catch (error) {
        alert("Error adding attempt: " + error.message);
      }
    }

    async function loadProblems() {
      const user = document.getElementById("list-user").value;
      console.log("Loading problems for user:", user || "All Problems");

      try {
        const url = user ? `/problems?user=${encodeURIComponent(user)}` : '/problems';
        const res = await fetch(url);

        if (!res.ok) {
          throw new Error(`HTTP error! status: ${res.status}`);
        }

        const data = await res.json();
        console.log("Received problems data:", data);

        const tbody = document.querySelector("#problems-table tbody");
        tbody.innerHTML = "";

        if (data.length === 0) {
          tbody.innerHTML = '<tr><td colspan="8" style="text-align: center; color: var(--muted); padding: 20px;">No problems found</td></tr>';
          return;
        }

        data.forEach(p => {
          const tr = document.createElement("tr");
          const solvedBy = p.solved_by_users || "";
          const browseButton = p.link ? `<button class="small" onclick="window.open('${p.link}', '_blank')">Browse</button>` : "";
          tr.innerHTML = `<td>${p.id}</td>
                          <td>${p.platform}</td>
                          <td>${p.name}</td>
                          <td>${p.topic}</td>
                          <td><span class="pill pill-${p.difficulty.toLowerCase()}">${p.difficulty}</span></td>
                          <td>
                            ${p.status
              ? `<span class="pill pill-status pill-status-${p.status.toLowerCase()}">${p.status}</span>`
              : ""
            }
                          </td>
                          <td>${solvedBy}</td>
                          <td>
                            ${browseButton}
                            <button class="small" onclick="prefillAttempt(${p.id}, '${user}')">Add Attempt</button>
                          </td>`;
          tbody.appendChild(tr);
        });
      } catch (error) {
        console.error("Error loading problems:", error);
        const tbody = document.querySelector("#problems-table tbody");
        tbody.innerHTML = '<tr><td colspan="8" style="text-align: center; color: var(--danger-fg); padding: 20px;">Error loading problems: ' + error.message + '</td></tr>';
      }
    }

    function prefillAttempt(problemId, user) {
      // Switch to the Attempts tab
      document.querySelectorAll(".tab-btn").forEach(b => b.classList.remove("active"));
      document.querySelector("[data-tab='attempts-tab']").classList.add("active");
      document.querySelectorAll("section").forEach(s => s.classList.remove("active"));
      document.getElementById("attempts-tab").classList.add("active");

      // Autofill fields
      document.getElementById("attempt-user").value = user || "";
      document.getElementById("problem-id").value = problemId;
      document.getElementById("attempt-date").value = new Date().toISOString().slice(0, 10); // today
      document.getElementById("status").value = "Solved";
      document.getElementById("time-taken").value = "";
      document.getElementById("first-try").value = "1";
      document.getElementById("notes").value = "";
    }

    async function loadAttempts() {
      const input = document.getElementById("attempt-list-user");
      const fallback = document.getElementById("attempt-user");
      const user = (input && input.value) || (fallback && fallback.value) || "";
      if (!user) {
        alert("Enter a user to load attempts");
        return;
      }

      const res = await fetch("/attempts?user=" + encodeURIComponent(user));
      const data = await res.json();
      const tbody = document.querySelector("#attempts-table tbody");
      tbody.innerHTML = "";

      data.forEach(a => {
        const tr = document.createElement("tr");
        const time = a.time_taken != null ? a.time_taken : "";
        const notes = a.notes || "";
        const firstTryLabel = a.first_try ? "Yes" : "No";
        const statusClass = a.status ? ` pill-status-${a.status.toLowerCase()}` : "";
        tr.innerHTML = `<td>${a.id}</td>
                        <td>${a.problem_name || a.problem_id}</td>
                        <td>${a.date}</td>
                        <td>${a.status ? `<span class="pill pill-status${statusClass}">${a.status}</span>` : ""}</td>
                        <td>${time}</td>
                        <td>${firstTryLabel}</td>
                        <td>${notes}</td>`;
        tbody.appendChild(tr);
      });
    }

    async function loadStats() {
      const user = document.getElementById("stats-user").value;
      if (!user) {
        alert("Select a user to load stats");
        return;
      }

      const res = await fetch("/stats/" + user);
      const stats = await res.json();
      const container = document.getElementById("stats-output");

      if (!stats || Object.keys(stats).length === 0) {
        container.innerHTML = "<p class='section-subtitle'>No stats yet for this user.</p>";
        return;
      }

      const val = (v, suffix = "") => (v == null ? "-" : suffix ? `${v}${suffix}` : v);
      const pct = v => (v == null ? "-" : `${v}%`);

      container.innerHTML = `
        <div class="stat-card">
          <div class="stat-label">Progress</div>
          <div class="stat-main">${val(stats.solved)}/${val(stats.attempted)}</div>
          <div class="stat-sub">Completion: ${pct(stats.completion_percent)}</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Difficulty Solved</div>
          <div class="stat-main">${val(stats.easy_solved)} / ${val(stats.medium_solved)} / ${val(stats.hard_solved)}</div>
          <div class="stat-sub">Easy / Medium / Hard</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Quality</div>
          <div class="stat-main">${pct(stats.first_try_accuracy)}</div>
          <div class="stat-sub">First-try accuracy</div>
          <div class="stat-tag-row">Early failure: ${pct(stats.early_failure_rate)}</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Pace</div>
          <div class="stat-main">${val(stats.problems_per_day)}</div>
          <div class="stat-sub">Problems per active day (${val(stats.active_days)} days)</div>
          <div class="stat-tag-row">Last 7 days: ${val(stats.solved_last_7_days)} solved</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Difficulty Trend</div>
          <div class="stat-main">${val(stats.difficulty_progression_index)}</div>
          <div class="stat-sub">1 = Easy, 2 = Medium, 3 = Hard</div>
          <div class="stat-tag-row">Avg Medium time: ${val(stats.avg_medium_time, ' min')}</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Revisits</div>
          <div class="stat-main">${val(stats.pending_revisits)}</div>
          <div class="stat-sub">Pending revisits</div>
          <div class="stat-tag-row">Re-solve rate: ${pct(stats.ressolve_success)}</div>
        </div>
      `;
    }

    async function loadLeaderboard() {
      const user = document.getElementById("leaderboard-user").value;
      const res = await fetch("/leaderboard");
      const lb = await res.json();
      const tbody = document.querySelector("#leaderboard-table tbody");
      tbody.innerHTML = "";

      lb.forEach((row, idx) => {
        const tr = document.createElement("tr");
        tr.innerHTML = `<td>${idx + 1}</td>
                        <td>${row.user}</td>
                        <td>${row.medium_hard}</td>
                        <td>${row.solved}</td>`;
        tbody.appendChild(tr);
      });
    }

    // Auto-load problems when page loads
    window.addEventListener('load', function () {
      console.log('Page loaded, loading problems...');
      loadProblems();
    });

    // Fallback: also try on DOMContentLoaded
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', function () {
        console.log('DOM loaded, loading problems...');
        loadProblems();
      });
    } else {
      // DOM is already loaded
      console.log('DOM already loaded, loading problems immediately...');
      loadProblems();
    }
  </script>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</body>

</html>